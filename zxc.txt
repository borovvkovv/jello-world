Messages FUNCTION RN1,C2
0,1/1,4
Types FUNCTION RN1,D3
.33,1/.66,2/1,3
CP FUNCTION P$Type,D3
1,15/2,20/3,25 
FUNC_Value_message FUNCTION P$Type,D3
1,4/2,9/3,16
Rand FUNCTION RN2,C2
0,1/1,101


Clients MATRIX ,1,100
INITIAL MCounter,100


GENERATE 2

SPLIT FN$Messages

ASSIGN Type,FN$Types
ASSIGN CP_time,FN$CP
ASSIGN Val,FN$FUNC_Value_message

TEST LE MCounter,2,Contin
TERMINATE

Contin ASSIGN counter,0

Set_sender_number ASSIGN counter+,1
RMULT ,P$counter
ASSIGN Sender,(FN$Rand\1)
Test E MX$Clients(1,P$Sender),0,Set_sender_number 
MSAVEVALUE Clients,1,P$Sender,1
SAVEVALUE MCounter-,1


ASSIGN counter,0
Set_receiver_number ASSIGN counter+,1
RMULT ,P$counter
ASSIGN Receiver,(FN$Rand\1)
Test E MX$Clients(1,P$Receiver),0,Set_receiver_number
MSAVEVALUE Clients,1,P$Receiver,1
SAVEVALUE MCounter-,1


TEST G P$Sender,P$Receiver,Param2


ASSIGN Delivery_time,((P$Sender-P$Receiver)#0.005+P$Val)
TRANSFER ,Prog



Param2 ASSIGN Delivery_time,((P$Receiver-P$Sender)#0.005+P$Val)


Prog QUEUE QBUS
SEIZE BUS 
DEPART QBUS 
ADVANCE P$Delivery_time 
RELEASE BUS
MSAVEVALUE Clients,1,P$Sender,0
SAVEVALUE MCounter+,1
ADVANCE P$CP_time 
Test E MX$Clients(1,P$Sender),0
MSAVEVALUE Clients,1,P$Sender,1
SAVEVALUE MCounter-,1
QUEUE QBUS 
SEIZE BUS
DEPART QBUS
ADVANCE P$Delivery_time
RELEASE BUS
MSAVEVALUE Clients,1,P$Receiver,0 
MSAVEVALUE Clients,1,P$Sender,0
SAVEVALUE MCounter+,2
TERMINATE 1
START 10
